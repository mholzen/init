#!/usr/bin/env coffee
highland = require 'highland'

columnCount = (items)->items.length
columnCount = -> 3
maxColumnCount = 0


parse = (line)->
  if line.startsWith '{'
    object = JSON.parse line
    [value] for key, value of object
  else
    line.split /[,\t]+/

fit = (item, width)->
  spaceCount = Math.max(Math.floor(width)-item.length, 0)
  # TODO: consider trimming from the right
  item[0..width] + Array(spaceCount).join ' '

width = process.stdout.columns ? 80

highland(process.stdin)
.split()
.filter (line) -> line.length > 0
.map parse
.doto (items)->
  maxColumnCount = Math.max(maxColumnCount, items.length)
# .sortBy (a,b)->
#   a[1].localeCompare b[1]
.map (items)->
  items.map (item)-> fit(item, width / columnCount(items))
    .join ''
.each (result)->
  process.stdout.write result + '\n'
